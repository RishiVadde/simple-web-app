pipeline { agent any environments { DEPLOY_DIR = '/opt/python-webapp' SERVICE = 'python-webapp' } stages { stage('Checkout') { steps { checkout scm } } stage('Build') { steps { sh 'python3 -m venv venv && . venv/bin/activate && pip install -r requirements.txt' } } stage('Test') { steps { sh '. venv/bin/activate && pytest -q' } } stage('Deploy') { steps { sh 'sudo mkdir -p /opt/python-webapp; sudo rsync -av --delete ./ /opt/python-webapp/; cd /opt/python-webapp; python3 -m venv venv; . venv/bin/activate; pip install -r requirements.txt; sudo systemctl restart python-webapp' } } stage('Smoke Test') { steps { sh 'curl -f http://localhost:5000/health' } } } }